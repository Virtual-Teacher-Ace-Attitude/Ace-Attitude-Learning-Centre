@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using AceAttitude.Data.Models
@model List<Course>
@inject IAuthService AuthService

@{
    ViewData["Title"] = "Course Details";
    Layout = "_Layout";

    ViewData["IsAuthenticated"] = Context.Session.Keys.Contains("CurrentUser");

    var currentUser = Context.Session.Keys.Contains("CurrentUser") ? AuthService.CurrentUser : null;
    ViewData["IsAdmin"] = currentUser?.UserType == UserType.Admin;
    ViewData["IsTeacher"] = currentUser?.UserType == UserType.Teacher;

    var kidsCoursePath = "~/images/kids-course.jpg";
    var teensCoursePath = "~/images/teens-course.jpg";
    var adultsCoursePath = "~/images/adults-course.jpg";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Ace Attitude - Courses</title>
    <link rel="stylesheet" href="~/css/site.css" />
    <script src="https://kit.fontawesome.com/c21727a50d.js" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/c21727a50d.js" crossorigin="anonymous"></script>
</head>
<body>

    <style>
        .date {
            font-size: 14px;
            color: #333;
        }

        .date i {
            margin-right: 5px; /* Add space between the icon and the date */
        }

        .starting-date {
            font-size: 14px;
            color: #333;
        }
    </style>

@*    <div class="btn-group" style="margin-bottom: 10px;">
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Level
        </button>
        <div class="dropdown-menu">
            <a class="dropdown-item" asp-controller="Course" asp-action="Index" asp-route-filterParam="Level" asp-route-filterParamValue="A1">A1</a>
            <a class="dropdown-item" asp-controller="Course" asp-action="Index" asp-route-filterParam="Level" asp-route-filterParamValue="A2">A2</a>
            <a class="dropdown-item" asp-controller="Course" asp-action="Index" asp-route-filterParam="Level" asp-route-filterParamValue="B1">B1</a>
            <a class="dropdown-item" asp-controller="Course" asp-action="Index" asp-route-filterParam="Level" asp-route-filterParamValue="B2">B2</a>
            <a class="dropdown-item" asp-controller="Course" asp-action="Index" asp-route-filterParam="Level" asp-route-filterParamValue="C1">C1</a>
            <a class="dropdown-item" asp-controller="Course" asp-action="Index" asp-route-filterParam="Level" asp-route-filterParamValue="C2">C2</a>
        </div>
    </div>

    <div class="btn-group" style="margin-bottom: 10px;">
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Age Group
        </button>
        <div class="dropdown-menu">
            <a class="dropdown-item" asp-controller="Course" asp-action="Index" asp-route-filterParam="AgeGroup" asp-route-filterParamValue="Kids">Kids</a>
            <a class="dropdown-item" asp-controller="Course" asp-action="Index" asp-route-filterParam="AgeGroup" asp-route-filterParamValue="Teens">Teens</a>
            <a class="dropdown-item" asp-controller="Course" asp-action="Index" asp-route-filterParam="AgeGroup" asp-route-filterParamValue="Adults">Adults</a>
        </div>
    </div>*@



    <div class="container">
        <div class="row">

            @if (Model.Count == 0)
            {
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-md-6">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 class="card-title">No courses available</h3>
                                    <p class="card-text" style="font-size: 1.2rem;">
                                        There are currently no courses that have been created for this category...
                                    </p>
                                </div>
                            </div>

                            @if ((bool)ViewData["IsTeacher"] || (bool)ViewData["IsAdmin"])
                            {
                                <p style="margin-top: 20px;" class="text-center">
                                    <a asp-controller="Course" asp-action="Create" class="btn btn-primary" style="padding: 10px 20px;">Create a new course</a>
                                </p>
                            }
                        </div>
                    </div>
                </div>
            }
            else
            {
                @if ((bool)ViewData["IsTeacher"] || (bool)ViewData["IsAdmin"])
                {
                    <p style="margin-top: 20px;">
                        <a asp-controller="Course" asp-action="Create" class="btn btn-primary" style="padding: 10px 20px;">Create a new course</a>
                    </p>
                }

                @foreach (var course in Model)
                {
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            @if (course.AgeGroup == AgeGroup.Kids)
                            {
                                <img src="@Url.Content(kidsCoursePath)" class="card-img-top" alt="Course Image">
                            }
                            @if (course.AgeGroup == AgeGroup.Teens)
                            {
                                <img src="@Url.Content(teensCoursePath)" class="card-img-top" alt="Course Image">
                            }
                            @if (course.AgeGroup == AgeGroup.Adults)
                            {
                                <img src="@Url.Content(adultsCoursePath)" class="card-img-top" alt="Course Image">
                            }
                            <div class="card-body">
                                <h5 class="card-title">@course.Title</h5>
                                <p class="card-text">@course.Description</p>
                                <ul class="list-unstyled">
                                    <li><strong>Teacher:</strong> @course.Teacher.User.FirstName @course.Teacher.User.LastName</li>
                                    <li><strong>Level:</strong> @course.Level</li>
                                    <li><strong>Age Group:</strong> @course.AgeGroup</li>
                                    <li><strong>Starting Date:</strong> <span class="starting-date">@course.StartingDate.ToString("dd/MM/yyyy")</span></li>
                                    <li><strong>Rating:</strong> @(course.Rating() >= 0 ? course.Rating().ToString("F2") : "N/A")</li>
                                </ul>
                                <div class="d-flex justify-content-between mt-auto">
                                    <!-- Flex container for buttons -->
                                    <a asp-controller="Course" asp-action="Details" asp-route-id="@course.Id" class="btn btn-link text-dark">
                                        <i class="fas fa-info-circle"></i> Details
                                    </a>


                                    @if ((bool)ViewData["IsAuthenticated"])
                                    {
                                        @if (course.TeacherId == currentUser.Id || (bool)ViewData["IsAdmin"])
                                        {
                                            <div class="d-flex">
                                                <!-- Flex container for edit and delete buttons -->
                                                <div class="mt-auto mr-2">
                                                    <!-- Margin right to separate icons -->
                                                    <a asp-controller="Course" asp-action="Edit" asp-route-id="@course.Id" class="btn btn-link text-warning">
                                                        <i class="fas fa-pencil-alt"></i> Edit
                                                    </a>
                                                </div>
                                                <div class="mt-auto mr-2">
                                                    <a asp-controller="Course" asp-action="Delete" asp-route-id="@course.Id" class="btn btn-link text-danger">
                                                        <i class="fas fa-trash-alt"></i> Delete
                                                    </a>
                                                </div>
                                            </div>
                                        }
                                        else if (currentUser.UserType == UserType.Student)
                                        {
                                            if (course.StudentCourses.Any(sc => sc.StudentId == currentUser.Id))
                                            {
                                                <a asp-controller="Course" asp-action="RateCourse" asp-route-id="@course.Id" class="btn btn-link text-dark">
                                                    <i class="fas fa-star"></i> Rate
                                                </a>
                                            }
                                            else
                                            {
                                                <form method="post" asp-controller="Course" asp-action="ApplyForCourseMVC" asp-route-id="@course.Id">
                                                    <button type="submit" class="btn btn-link text-dark">
                                                        <i class="fas fa-hand-pointer"></i> Apply
                                                    </button>
                                                </form>
                                            }
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
    


</body>
</html>